Rear_tire_age = min(Rear_tire_age, na.rm=TRUE) + row_number() -1
) %>%
filter(is_lap) %>%
print(n=50)
results %>%
mutate(LapTime     = str_extract(data, rexp_times),
TotalLaps   = as.integer(str_extract(data, rexp_total_laps)),
FullLaps    = as.integer(str_extract(data, rexp_full_laps)),
speed       = as.double(str_extract(data, rexp_speed)),
FrontTire   = str_extract(data, rexp_f_tire),
RearTire    = str_extract(data, rexp_r_tire),
run_number  = as.integer(str_extract(data, rexp_run_number)),
riderNumber = as.integer(str_extract(data, rexp_rider_number)),
pitting     = str_extract(data, 'P'),
invalidatedLap = str_extract(data, "\\*")) %>%
left_join(riders, c("riderNumber" = "X.1")) %>%
fill(c("riderNumber","X","Rider","Nation","Team","Motorcycle","run_number","FrontTire","RearTire","TotalLaps","FullLaps")) %>%
slice(-1) %>%
group_by(Rider, data) %>%
mutate(
T1 = as.double(str_extract_all(data, rexp_times)[[1]][2]),
T2 = as.double(str_extract_all(data, rexp_times)[[1]][3]),
T3 = as.double(str_extract_all(data, rexp_times)[[1]][4]),
T4 = as.double(str_extract_all(data, rexp_times)[[1]][5])
) %>%
mutate(
Front_tire_age = str_extract_all(data, rexp_tire_life)[[1]][1],
Rear_tire_age  = str_extract_all(data, rexp_tire_life)[[1]][2],
Front_tire_age = as.integer(recode(Front_tire_age, "New Tyre" = "0")),
Rear_tire_age = as.integer(recode(Rear_tire_age, "New Tyre" = "0")),
is_lap = !is.na(LapTime)
) %>%
group_by(Rider, is_lap) %>%
mutate(
LapNumber = case_when(is_lap ~row_number()),
LapType =  case_when(
!is.na(pitting) & is_lap ~ "In Lap",
!is.na(lag(pitting)) & is_lap  ~ "Out Lap",
LapNumber == 1 ~ "Out Lap"
),
run_number = case_when(is_lap ~ run_number)
) %>%
select(data, riderNumber, Rider:Motorcycle, X, TotalLaps, FullLaps, run_number, FrontTire, RearTire, Front_tire_age, Rear_tire_age, invalidatedLap, LapNumber, LapType, LapTime, T1, T2, T3, T4, speed) %>%
group_by() %>%
fill(c("Front_tire_age", "Rear_tire_age")) %>%
group_by(Rider, run_number, is_lap) %>%
mutate(
Front_tire_age = min(Front_tire_age, na.rm=TRUE) + row_number() -1,
Rear_tire_age = min(Rear_tire_age, na.rm=TRUE) + row_number() -1
) %>%
filter(is_lap) %>%
select(-c("is_lap","data")) M
results %>%
mutate(LapTime     = str_extract(data, rexp_times),
TotalLaps   = as.integer(str_extract(data, rexp_total_laps)),
FullLaps    = as.integer(str_extract(data, rexp_full_laps)),
speed       = as.double(str_extract(data, rexp_speed)),
FrontTire   = str_extract(data, rexp_f_tire),
RearTire    = str_extract(data, rexp_r_tire),
run_number  = as.integer(str_extract(data, rexp_run_number)),
riderNumber = as.integer(str_extract(data, rexp_rider_number)),
pitting     = str_extract(data, 'P'),
invalidatedLap = str_extract(data, "\\*")) %>%
left_join(riders, c("riderNumber" = "X.1")) %>%
fill(c("riderNumber","X","Rider","Nation","Team","Motorcycle","run_number","FrontTire","RearTire","TotalLaps","FullLaps")) %>%
slice(-1) %>%
group_by(Rider, data) %>%
mutate(
T1 = as.double(str_extract_all(data, rexp_times)[[1]][2]),
T2 = as.double(str_extract_all(data, rexp_times)[[1]][3]),
T3 = as.double(str_extract_all(data, rexp_times)[[1]][4]),
T4 = as.double(str_extract_all(data, rexp_times)[[1]][5])
) %>%
mutate(
Front_tire_age = str_extract_all(data, rexp_tire_life)[[1]][1],
Rear_tire_age  = str_extract_all(data, rexp_tire_life)[[1]][2],
Front_tire_age = as.integer(recode(Front_tire_age, "New Tyre" = "0")),
Rear_tire_age = as.integer(recode(Rear_tire_age, "New Tyre" = "0")),
is_lap = !is.na(LapTime)
) %>%
group_by(Rider, is_lap) %>%
mutate(
LapNumber = case_when(is_lap ~row_number()),
LapType =  case_when(
!is.na(pitting) & is_lap ~ "In Lap",
!is.na(lag(pitting)) & is_lap  ~ "Out Lap",
LapNumber == 1 ~ "Out Lap"
),
run_number = case_when(is_lap ~ run_number)
) %>%
select(data, riderNumber, Rider:Motorcycle, X, TotalLaps, FullLaps, run_number, FrontTire, RearTire, Front_tire_age, Rear_tire_age, invalidatedLap, LapNumber, LapType, LapTime, T1, T2, T3, T4, speed) %>%
group_by() %>%
fill(c("Front_tire_age", "Rear_tire_age")) %>%
group_by(Rider, run_number, is_lap) %>%
mutate(
Front_tire_age = min(Front_tire_age, na.rm=TRUE) + row_number() -1,
Rear_tire_age = min(Rear_tire_age, na.rm=TRUE) + row_number() -1
) %>%
filter(is_lap) %>%
select(-c("is_lap","data")) %>%
print(n=50)
results %>%
mutate(LapTime     = str_extract(data, rexp_times),
TotalLaps   = as.integer(str_extract(data, rexp_total_laps)),
FullLaps    = as.integer(str_extract(data, rexp_full_laps)),
speed       = as.double(str_extract(data, rexp_speed)),
FrontTire   = str_extract(data, rexp_f_tire),
RearTire    = str_extract(data, rexp_r_tire),
run_number  = as.integer(str_extract(data, rexp_run_number)),
riderNumber = as.integer(str_extract(data, rexp_rider_number)),
pitting     = str_extract(data, 'P'),
invalidatedLap = str_extract(data, "\\*")) %>%
left_join(riders, c("riderNumber" = "X.1")) %>%
fill(c("riderNumber","X","Rider","Nation","Team","Motorcycle","run_number","FrontTire","RearTire","TotalLaps","FullLaps")) %>%
slice(-1) %>%
group_by(Rider, data) %>%
mutate(
T1 = as.double(str_extract_all(data, rexp_times)[[1]][2]),
T2 = as.double(str_extract_all(data, rexp_times)[[1]][3]),
T3 = as.double(str_extract_all(data, rexp_times)[[1]][4]),
T4 = as.double(str_extract_all(data, rexp_times)[[1]][5])
) %>%
mutate(
Front_tire_age = str_extract_all(data, rexp_tire_life)[[1]][1],
Rear_tire_age  = str_extract_all(data, rexp_tire_life)[[1]][2],
Front_tire_age = as.integer(recode(Front_tire_age, "New Tyre" = "0")),
Rear_tire_age = as.integer(recode(Rear_tire_age, "New Tyre" = "0")),
is_lap = !is.na(LapTime)
) %>%
group_by(Rider, is_lap) %>%
mutate(
LapNumber = case_when(is_lap ~row_number()),
LapType =  case_when(
!is.na(pitting) & is_lap ~ "In Lap",
!is.na(lag(pitting)) & is_lap  ~ "Out Lap",
LapNumber == 1 ~ "Out Lap"
),
run_number = case_when(is_lap ~ run_number)
) %>%
select(data, riderNumber, Rider:Motorcycle, X, TotalLaps, FullLaps, run_number, FrontTire, RearTire, Front_tire_age, Rear_tire_age, invalidatedLap, LapNumber, LapType, LapTime, T1, T2, T3, T4, speed) %>%
group_by() %>%
fill(c("Front_tire_age", "Rear_tire_age")) %>%
group_by(Rider, run_number, is_lap) %>%
mutate(
Front_tire_age = min(Front_tire_age, na.rm=TRUE) + row_number() -1,
Rear_tire_age = min(Rear_tire_age, na.rm=TRUE) + row_number() -1
) %>%
group_by() %>%
filter(is_lap) %>%
select(-c("is_lap","data")) %>%
print(n=50)
results %>%
mutate(LapTime     = str_extract(data, rexp_times),
TotalLaps   = as.integer(str_extract(data, rexp_total_laps)),
FullLaps    = as.integer(str_extract(data, rexp_full_laps)),
speed       = as.double(str_extract(data, rexp_speed)),
FrontTire   = str_extract(data, rexp_f_tire),
RearTire    = str_extract(data, rexp_r_tire),
run_number  = as.integer(str_extract(data, rexp_run_number)),
riderNumber = as.integer(str_extract(data, rexp_rider_number)),
pitting     = str_extract(data, 'P'),
invalidatedLap = str_extract(data, "\\*")) %>%
left_join(riders, c("riderNumber" = "X.1")) %>%
fill(c("riderNumber","X","Rider","Nation","Team","Motorcycle","run_number","FrontTire","RearTire","TotalLaps","FullLaps")) %>%
slice(-1) %>%
group_by(Rider, data) %>%
mutate(
T1 = as.double(str_extract_all(data, rexp_times)[[1]][2]),
T2 = as.double(str_extract_all(data, rexp_times)[[1]][3]),
T3 = as.double(str_extract_all(data, rexp_times)[[1]][4]),
T4 = as.double(str_extract_all(data, rexp_times)[[1]][5])
) %>%
mutate(
Front_tire_age = str_extract_all(data, rexp_tire_life)[[1]][1],
Rear_tire_age  = str_extract_all(data, rexp_tire_life)[[1]][2],
Front_tire_age = as.integer(recode(Front_tire_age, "New Tyre" = "0")),
Rear_tire_age = as.integer(recode(Rear_tire_age, "New Tyre" = "0")),
is_lap = !is.na(LapTime)
) %>%
group_by(Rider, is_lap) %>%
mutate(
LapNumber = case_when(is_lap ~row_number()),
LapType =  case_when(
!is.na(pitting) & is_lap ~ "In Lap",
!is.na(lag(pitting)) & is_lap  ~ "Out Lap",
LapNumber == 1 ~ "Out Lap"
),
run_number = case_when(is_lap ~ run_number)
) %>%
select(data, riderNumber, Rider:Motorcycle, X, TotalLaps, FullLaps, run_number, FrontTire, RearTire, Front_tire_age, Rear_tire_age, invalidatedLap, LapNumber, LapType, LapTime, T1, T2, T3, T4, speed) %>%
group_by() %>%
fill(c("Front_tire_age", "Rear_tire_age")) %>%
group_by(Rider, run_number, is_lap) %>%
mutate(
Front_tire_age = min(Front_tire_age, na.rm=TRUE) + row_number() -1,
Rear_tire_age = min(Rear_tire_age, na.rm=TRUE) + row_number() -1
) %>%
group_by() %>%
filter(is_lap) %>%
select(-c("is_lap","data")) %>%
print(n=500)
results %>%
mutate(LapTime     = str_extract(data, rexp_times),
TotalLaps   = as.integer(str_extract(data, rexp_total_laps)),
FullLaps    = as.integer(str_extract(data, rexp_full_laps)),
speed       = as.double(str_extract(data, rexp_speed)),
FrontTire   = str_extract(data, rexp_f_tire),
RearTire    = str_extract(data, rexp_r_tire),
run_number  = as.integer(str_extract(data, rexp_run_number)),
riderNumber = as.integer(str_extract(data, rexp_rider_number)),
pitting     = str_extract(data, 'P'),
invalidatedLap = str_extract(data, "\\*")) %>%
left_join(riders, c("riderNumber" = "X.1")) %>%
fill(c("riderNumber","X","Rider","Nation","Team","Motorcycle","run_number","FrontTire","RearTire","TotalLaps","FullLaps")) %>%
slice(-1) %>%
group_by(Rider, data) %>%
mutate(
T1 = as.double(str_extract_all(data, rexp_times)[[1]][2]),
T2 = as.double(str_extract_all(data, rexp_times)[[1]][3]),
T3 = as.double(str_extract_all(data, rexp_times)[[1]][4]),
T4 = as.double(str_extract_all(data, rexp_times)[[1]][5])
) %>%
mutate(
Front_tire_age = str_extract_all(data, rexp_tire_life)[[1]][1],
Rear_tire_age  = str_extract_all(data, rexp_tire_life)[[1]][2],
Front_tire_age = as.integer(recode(Front_tire_age, "New Tyre" = "0")),
Rear_tire_age = as.integer(recode(Rear_tire_age, "New Tyre" = "0")),
is_lap = !is.na(LapTime)
) %>%
group_by(Rider, is_lap) %>%
mutate(
LapNumber = case_when(is_lap ~row_number()),
LapType =  case_when(
!is.na(pitting) & is_lap ~ "In",
!is.na(lag(pitting)) & is_lap  ~ "Out",
LapNumber == 1 ~ "Out",
TRUE ~ "Speed"
),
run_number = case_when(is_lap ~ run_number)
) %>%
select(data, riderNumber, Rider:Motorcycle, X, TotalLaps, FullLaps, run_number, FrontTire, RearTire, Front_tire_age, Rear_tire_age, invalidatedLap, LapNumber, LapType, LapTime, T1, T2, T3, T4, speed) %>%
group_by() %>%
fill(c("Front_tire_age", "Rear_tire_age")) %>%
group_by(Rider, run_number, is_lap) %>%
mutate(
Front_tire_age = min(Front_tire_age, na.rm=TRUE) + row_number() -1,
Rear_tire_age = min(Rear_tire_age, na.rm=TRUE) + row_number() -1
) %>%
group_by() %>%
filter(is_lap) %>%
select(-c("is_lap","data")) %>%
print(n=500)
full_df <- results %>%
mutate(LapTime     = str_extract(data, rexp_times),
TotalLaps   = as.integer(str_extract(data, rexp_total_laps)),
FullLaps    = as.integer(str_extract(data, rexp_full_laps)),
speed       = as.double(str_extract(data, rexp_speed)),
FrontTire   = str_extract(data, rexp_f_tire),
RearTire    = str_extract(data, rexp_r_tire),
run_number  = as.integer(str_extract(data, rexp_run_number)),
riderNumber = as.integer(str_extract(data, rexp_rider_number)),
pitting     = str_extract(data, 'P'),
invalidatedLap = str_extract(data, "\\*")) %>%
left_join(riders, c("riderNumber" = "X.1")) %>%
fill(c("riderNumber","X","Rider","Nation","Team","Motorcycle","run_number","FrontTire","RearTire","TotalLaps","FullLaps")) %>%
slice(-1) %>%
group_by(Rider, data) %>%
mutate(
T1 = as.double(str_extract_all(data, rexp_times)[[1]][2]),
T2 = as.double(str_extract_all(data, rexp_times)[[1]][3]),
T3 = as.double(str_extract_all(data, rexp_times)[[1]][4]),
T4 = as.double(str_extract_all(data, rexp_times)[[1]][5])
) %>%
mutate(
Front_tire_age = str_extract_all(data, rexp_tire_life)[[1]][1],
Rear_tire_age  = str_extract_all(data, rexp_tire_life)[[1]][2],
Front_tire_age = as.integer(recode(Front_tire_age, "New Tyre" = "0")),
Rear_tire_age = as.integer(recode(Rear_tire_age, "New Tyre" = "0")),
is_lap = !is.na(LapTime)
) %>%
group_by(Rider, is_lap) %>%
mutate(
LapNumber = case_when(is_lap ~row_number()),
LapType =  case_when(
!is.na(pitting) & is_lap ~ "In",
!is.na(lag(pitting)) & is_lap  ~ "Out",
LapNumber == 1 ~ "Out",
TRUE ~ "Speed"
),
run_number = case_when(is_lap ~ run_number)
) %>%
select(data, riderNumber, Rider:Motorcycle, X, TotalLaps, FullLaps, run_number, FrontTire, RearTire, Front_tire_age, Rear_tire_age, invalidatedLap, LapNumber, LapType, LapTime, T1, T2, T3, T4, speed) %>%
group_by() %>%
fill(c("Front_tire_age", "Rear_tire_age")) %>%
group_by(Rider, run_number, is_lap) %>%
mutate(
Front_tire_age = min(Front_tire_age, na.rm=TRUE) + row_number() -1,
Rear_tire_age = min(Rear_tire_age, na.rm=TRUE) + row_number() -1
) %>%
group_by() %>%
filter(is_lap) %>%
select(-c("is_lap","data")) %>%
print(n=500)
full_df %>%
filter(riderNumber == 30) %>%
print(50)
full_df <- results %>%
mutate(LapTime     = str_extract(data, rexp_times),
TotalLaps   = as.integer(str_extract(data, rexp_total_laps)),
FullLaps    = as.integer(str_extract(data, rexp_full_laps)),
speed       = as.double(str_extract(data, rexp_speed)),
FrontTire   = str_extract(data, rexp_f_tire),
RearTire    = str_extract(data, rexp_r_tire),
run_number  = as.integer(str_extract(data, rexp_run_number)),
riderNumber = as.integer(str_extract(data, rexp_rider_number)),
pitting     = str_extract(data, 'P'),
invalidatedLap = str_extract(data, "\\*")) %>%
left_join(riders, c("riderNumber" = "X.1")) %>%
fill(c("riderNumber","X","Rider","Nation","Team","Motorcycle","run_number","FrontTire","RearTire","TotalLaps","FullLaps")) %>%
slice(-1) %>%
group_by(Rider, data) %>%
mutate(
T1 = as.double(str_extract_all(data, rexp_times)[[1]][2]),
T2 = as.double(str_extract_all(data, rexp_times)[[1]][3]),
T3 = as.double(str_extract_all(data, rexp_times)[[1]][4]),
T4 = as.double(str_extract_all(data, rexp_times)[[1]][5])
) %>%
mutate(
Front_tire_age = str_extract_all(data, rexp_tire_life)[[1]][1],
Rear_tire_age  = str_extract_all(data, rexp_tire_life)[[1]][2],
Front_tire_age = as.integer(recode(Front_tire_age, "New Tyre" = "0")),
Rear_tire_age = as.integer(recode(Rear_tire_age, "New Tyre" = "0")),
is_lap = !is.na(LapTime)
) %>%
group_by(Rider, is_lap) %>%
mutate(
LapNumber = case_when(is_lap ~row_number()),
LapType =  case_when(
!is.na(pitting) & is_lap ~ "In",
!is.na(lag(pitting)) & is_lap  ~ "Out",
LapNumber == 1 ~ "Out",
TRUE ~ "Speed"
),
run_number = case_when(is_lap ~ run_number)
) %>%
select(data, riderNumber, Rider:Motorcycle, X, TotalLaps, FullLaps, run_number, FrontTire, RearTire, Front_tire_age, Rear_tire_age, invalidatedLap, LapNumber, LapType, LapTime, T1, T2, T3, T4, speed) %>%
group_by() %>%
fill(c("Front_tire_age", "Rear_tire_age")) %>%
group_by(Rider, run_number, is_lap) %>%
mutate(
Front_tire_age = min(Front_tire_age, na.rm=TRUE) + row_number() -1,
Rear_tire_age = min(Rear_tire_age, na.rm=TRUE) + row_number() -1
) %>%
group_by() %>%
filter(is_lap) %>%
select(-c("is_lap","data")) %>%
print(n=500)
results %>%
mutate(LapTime     = str_extract(data, rexp_times),
TotalLaps   = as.integer(str_extract(data, rexp_total_laps)),
FullLaps    = as.integer(str_extract(data, rexp_full_laps)),
speed       = as.double(str_extract(data, rexp_speed)),
FrontTire   = str_extract(data, rexp_f_tire),
RearTire    = str_extract(data, rexp_r_tire),
run_number  = as.integer(str_extract(data, rexp_run_number)),
riderNumber = as.integer(str_extract(data, rexp_rider_number)),
pitting     = str_extract(data, 'P'),
invalidatedLap = str_extract(data, "\\*")) %>%
left_join(riders, c("riderNumber" = "X.1")) %>%
fill(c("riderNumber","X","Rider","Nation","Team","Motorcycle","run_number","FrontTire","RearTire","TotalLaps","FullLaps")) %>%
slice(-1) %>%
group_by(Rider, data) %>%
mutate(
T1 = as.double(str_extract_all(data, rexp_times)[[1]][2]),
T2 = as.double(str_extract_all(data, rexp_times)[[1]][3]),
T3 = as.double(str_extract_all(data, rexp_times)[[1]][4]),
T4 = as.double(str_extract_all(data, rexp_times)[[1]][5])
) %>%
mutate(
Front_tire_age = str_extract_all(data, rexp_tire_life)[[1]][1],
Rear_tire_age  = str_extract_all(data, rexp_tire_life)[[1]][2],
Front_tire_age = as.integer(recode(Front_tire_age, "New Tyre" = "0")),
Rear_tire_age = as.integer(recode(Rear_tire_age, "New Tyre" = "0")),
is_lap = !is.na(LapTime)
) %>%
group_by(Rider, is_lap) %>%
mutate(
LapNumber = case_when(is_lap ~row_number()),
LapType =  case_when(
!is.na(pitting) & is_lap ~ "In",
!is.na(lag(pitting)) & is_lap  ~ "Out",
LapNumber == 1 ~ "Out",
TRUE ~ "Speed"
),
run_number = case_when(is_lap ~ run_number)
) %>%
select(data, riderNumber, Rider:Motorcycle, X, TotalLaps, FullLaps, run_number, FrontTire, RearTire, Front_tire_age, Rear_tire_age, invalidatedLap, LapNumber, LapType, LapTime, T1, T2, T3, T4, speed) %>%
group_by() %>%
fill(c("Front_tire_age", "Rear_tire_age")) %>%
group_by(Rider, run_number, is_lap) %>%
mutate(
Front_tire_age = min(Front_tire_age, na.rm=TRUE) + row_number() -1,
Rear_tire_age = min(Rear_tire_age, na.rm=TRUE) + row_number() -1
) %>%
group_by() %>%
filter(is_lap) %>%
# select(-c("is_lap","data")) %>%
filter(riderNumber = 30)
results %>%
mutate(LapTime     = str_extract(data, rexp_times),
TotalLaps   = as.integer(str_extract(data, rexp_total_laps)),
FullLaps    = as.integer(str_extract(data, rexp_full_laps)),
speed       = as.double(str_extract(data, rexp_speed)),
FrontTire   = str_extract(data, rexp_f_tire),
RearTire    = str_extract(data, rexp_r_tire),
run_number  = as.integer(str_extract(data, rexp_run_number)),
riderNumber = as.integer(str_extract(data, rexp_rider_number)),
pitting     = str_extract(data, 'P'),
invalidatedLap = str_extract(data, "\\*")) %>%
left_join(riders, c("riderNumber" = "X.1")) %>%
fill(c("riderNumber","X","Rider","Nation","Team","Motorcycle","run_number","FrontTire","RearTire","TotalLaps","FullLaps")) %>%
slice(-1) %>%
group_by(Rider, data) %>%
mutate(
T1 = as.double(str_extract_all(data, rexp_times)[[1]][2]),
T2 = as.double(str_extract_all(data, rexp_times)[[1]][3]),
T3 = as.double(str_extract_all(data, rexp_times)[[1]][4]),
T4 = as.double(str_extract_all(data, rexp_times)[[1]][5])
) %>%
mutate(
Front_tire_age = str_extract_all(data, rexp_tire_life)[[1]][1],
Rear_tire_age  = str_extract_all(data, rexp_tire_life)[[1]][2],
Front_tire_age = as.integer(recode(Front_tire_age, "New Tyre" = "0")),
Rear_tire_age = as.integer(recode(Rear_tire_age, "New Tyre" = "0")),
is_lap = !is.na(LapTime)
) %>%
group_by(Rider, is_lap) %>%
mutate(
LapNumber = case_when(is_lap ~row_number()),
LapType =  case_when(
!is.na(pitting) & is_lap ~ "In",
!is.na(lag(pitting)) & is_lap  ~ "Out",
LapNumber == 1 ~ "Out",
TRUE ~ "Speed"
),
run_number = case_when(is_lap ~ run_number)
) %>%
select(data, riderNumber, Rider:Motorcycle, X, TotalLaps, FullLaps, run_number, FrontTire, RearTire, Front_tire_age, Rear_tire_age, invalidatedLap, LapNumber, LapType, LapTime, T1, T2, T3, T4, speed) %>%
group_by() %>%
fill(c("Front_tire_age", "Rear_tire_age")) %>%
group_by(Rider, run_number, is_lap) %>%
mutate(
Front_tire_age = min(Front_tire_age, na.rm=TRUE) + row_number() -1,
Rear_tire_age = min(Rear_tire_age, na.rm=TRUE) + row_number() -1
) %>%
group_by() %>%
filter(is_lap) %>%
# select(-c("is_lap","data")) %>%
filter(riderNumber = 30) %>%
print(300)
results %>%
mutate(LapTime     = str_extract(data, rexp_times),
TotalLaps   = as.integer(str_extract(data, rexp_total_laps)),
FullLaps    = as.integer(str_extract(data, rexp_full_laps)),
speed       = as.double(str_extract(data, rexp_speed)),
FrontTire   = str_extract(data, rexp_f_tire),
RearTire    = str_extract(data, rexp_r_tire),
run_number  = as.integer(str_extract(data, rexp_run_number)),
riderNumber = as.integer(str_extract(data, rexp_rider_number)),
pitting     = str_extract(data, 'P'),
invalidatedLap = str_extract(data, "\\*")) %>%
left_join(riders, c("riderNumber" = "X.1")) %>%
fill(c("riderNumber","X","Rider","Nation","Team","Motorcycle","run_number","FrontTire","RearTire","TotalLaps","FullLaps")) %>%
slice(-1) %>%
group_by(Rider, data) %>%
mutate(
T1 = as.double(str_extract_all(data, rexp_times)[[1]][2]),
T2 = as.double(str_extract_all(data, rexp_times)[[1]][3]),
T3 = as.double(str_extract_all(data, rexp_times)[[1]][4]),
T4 = as.double(str_extract_all(data, rexp_times)[[1]][5])
) %>%
mutate(
Front_tire_age = str_extract_all(data, rexp_tire_life)[[1]][1],
Rear_tire_age  = str_extract_all(data, rexp_tire_life)[[1]][2],
Front_tire_age = as.integer(recode(Front_tire_age, "New Tyre" = "0")),
Rear_tire_age = as.integer(recode(Rear_tire_age, "New Tyre" = "0")),
is_lap = !is.na(LapTime)
) %>%
group_by(Rider, is_lap) %>%
mutate(
LapNumber = case_when(is_lap ~row_number()),
LapType =  case_when(
!is.na(pitting) & is_lap ~ "In",
!is.na(lag(pitting)) & is_lap  ~ "Out",
LapNumber == 1 ~ "Out",
TRUE ~ "Speed"
),
run_number = case_when(is_lap ~ run_number)
) %>%
select(data, riderNumber, Rider:Motorcycle, X, TotalLaps, FullLaps, run_number, FrontTire, RearTire, Front_tire_age, Rear_tire_age, invalidatedLap, LapNumber, LapType, LapTime, T1, T2, T3, T4, speed) %>%
group_by() %>%
fill(c("Front_tire_age", "Rear_tire_age")) %>%
group_by(Rider, run_number, is_lap) %>%
mutate(
Front_tire_age = min(Front_tire_age, na.rm=TRUE) + row_number() -1,
Rear_tire_age = min(Rear_tire_age, na.rm=TRUE) + row_number() -1
) %>%
group_by() %>%
filter(is_lap) %>%
# select(-c("is_lap","data")) %>%
filter(riderNumber == 30) %>%
print(300)
